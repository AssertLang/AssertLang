#!/usr/bin/env python3
"""
PW CLI - AssertLang command-line tool
"""

import sys
import argparse
from pathlib import Path

# Add parent directory to path
sys.path.insert(0, str(Path(__file__).parent.parent))

from dsl.runtime import PWRuntime


def cmd_run(args):
    """Run a PW file"""
    if not Path(args.file).exists():
        print(f"Error: File not found: {args.file}")
        return 1

    runtime = PWRuntime(use_charcnn=not args.no_charcnn)

    try:
        runtime.execute_file(args.file)
        return 0
    except Exception as e:
        if args.debug:
            raise
        print(f"Error: {e}")
        return 1


def cmd_version(args):
    """Show version"""
    print("PW (AssertLang) 2.2.0-alpha1")
    print("Phase 4.2: LSP + Runtime")
    return 0


def main():
    parser = argparse.ArgumentParser(
        prog='pw',
        description='AssertLang CLI - Run and manage PW programs'
    )

    subparsers = parser.add_subparsers(dest='command', help='Command to run')

    # pw run
    run_parser = subparsers.add_parser('run', help='Run a PW file')
    run_parser.add_argument('file', help='PW file to run')
    run_parser.add_argument('--no-charcnn', action='store_true', help='Disable CharCNN model')
    run_parser.add_argument('--debug', action='store_true', help='Show full stack traces')
    run_parser.set_defaults(func=cmd_run)

    # pw version
    version_parser = subparsers.add_parser('version', help='Show version')
    version_parser.set_defaults(func=cmd_version)

    args = parser.parse_args()

    if not args.command:
        parser.print_help()
        return 1

    return args.func(args)


if __name__ == '__main__':
    sys.exit(main())
